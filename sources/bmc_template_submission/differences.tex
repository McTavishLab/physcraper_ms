%% BioMed_Central_Tex_Template_v1.06
%DIF LATEXDIFF DIFFERENCE FILE
%DIF DEL sources/bmc_template_submission/bmc_article_submission_2021-01-08.tex   Mon May  3 19:18:01 2021
%DIF ADD sources/bmc_template_submission/bmc_article.tex                         Tue May  4 00:39:13 2021
%%                                      %
%  bmc_article.tex            ver: 1.06 %
%                                       %

%%IMPORTANT: do not delete the first line of this template
%%It must be present to enable the BMC Submission system to
%%recognise this template!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                     %%
%%  LaTeX template for BioMed Central  %%
%%     journal article submissions     %%
%%                                     %%
%%          <8 June 2012>              %%
%%                                     %%
%%                                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% For instructions on how to fill out this Tex template           %%
%% document please refer to Readme.html and the instructions for   %%
%% authors page on the biomed central website                      %%
%% https://www.biomedcentral.com/getpublished                      %%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%% BioMed Central currently use the MikTex distribution of         %%
%% TeX for Windows) of TeX and LaTeX.  This is available from      %%
%% https://miktex.org/                                             %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% additional documentclass options:
%  [doublespacing]
%  [linenumbers]   - put the line numbers on margins

%%% loading packages, author definitions

%\documentclass[twocolumn]{bmcart}% uncomment this for twocolumn layout and comment line below
\documentclass{bmcart}

%%% Load packages
\usepackage{amsthm,amsmath}
%\RequirePackage[numbers]{natbib}
%\RequirePackage[authoryear]{natbib}% uncomment this for author-year bibliography
\RequirePackage{hyperref}
\usepackage[utf8]{inputenc} %unicode support
%\usepackage[applemac]{inputenc} %applemac support if unicode package fails
%\usepackage[latin1]{inputenc} %UNIX support if unicode package fails

%\usepackage{hyperref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                             %%
%%  If you wish to display your graphics for   %%
%%  your own use using includegraphic or       %%
%%  includegraphics, then comment out the      %%
%%  following two lines of code.               %%
%%  NB: These line *must* be included when     %%
%%  submitting to BMC.                         %%
%%  All figure files must be submitted as      %%
%%  separate graphics through the BMC          %%
%%  submission process, not included in the    %%
%%  submitted article.                         %%
%%                                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\includegraphic{}
\def\includegraphics{}

%%% Put your definitions there:
\startlocaldefs
\endlocaldefs

%%% Begin ...
%DIF PREAMBLE EXTENSION ADDED BY LATEXDIFF
%DIF UNDERLINE PREAMBLE %DIF PREAMBLE
\RequirePackage[normalem]{ulem} %DIF PREAMBLE
\RequirePackage{color}\definecolor{RED}{rgb}{1,0,0}\definecolor{BLUE}{rgb}{0,0,1} %DIF PREAMBLE
\providecommand{\DIFaddtex}[1]{{\protect\color{blue}\uwave{#1}}} %DIF PREAMBLE
\providecommand{\DIFdeltex}[1]{{\protect\color{red}\sout{#1}}}                      %DIF PREAMBLE
%DIF SAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddbegin}{} %DIF PREAMBLE
\providecommand{\DIFaddend}{} %DIF PREAMBLE
\providecommand{\DIFdelbegin}{} %DIF PREAMBLE
\providecommand{\DIFdelend}{} %DIF PREAMBLE
\providecommand{\DIFmodbegin}{} %DIF PREAMBLE
\providecommand{\DIFmodend}{} %DIF PREAMBLE
%DIF FLOATSAFE PREAMBLE %DIF PREAMBLE
\providecommand{\DIFaddFL}[1]{\DIFadd{#1}} %DIF PREAMBLE
\providecommand{\DIFdelFL}[1]{\DIFdel{#1}} %DIF PREAMBLE
\providecommand{\DIFaddbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFaddendFL}{} %DIF PREAMBLE
\providecommand{\DIFdelbeginFL}{} %DIF PREAMBLE
\providecommand{\DIFdelendFL}{} %DIF PREAMBLE
%DIF HYPERREF PREAMBLE %DIF PREAMBLE
\providecommand{\DIFadd}[1]{\texorpdfstring{\DIFaddtex{#1}}{#1}} %DIF PREAMBLE
\providecommand{\DIFdel}[1]{\texorpdfstring{\DIFdeltex{#1}}{}} %DIF PREAMBLE
%DIF LISTINGS PREAMBLE %DIF PREAMBLE
\RequirePackage{listings} %DIF PREAMBLE
\RequirePackage{color} %DIF PREAMBLE
\lstdefinelanguage{DIFcode}{ %DIF PREAMBLE
%DIF DIFCODE_UNDERLINE %DIF PREAMBLE
  moredelim=[il][\color{red}\sout]{\%DIF\ <\ }, %DIF PREAMBLE
  moredelim=[il][\color{blue}\uwave]{\%DIF\ >\ } %DIF PREAMBLE
} %DIF PREAMBLE
\lstdefinestyle{DIFverbatimstyle}{ %DIF PREAMBLE
	language=DIFcode, %DIF PREAMBLE
	basicstyle=\ttfamily, %DIF PREAMBLE
	columns=fullflexible, %DIF PREAMBLE
	keepspaces=true %DIF PREAMBLE
} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim}{\lstset{style=DIFverbatimstyle}}{} %DIF PREAMBLE
\lstnewenvironment{DIFverbatim*}{\lstset{style=DIFverbatimstyle,showspaces=true}}{} %DIF PREAMBLE
%DIF END PREAMBLE EXTENSION ADDED BY LATEXDIFF

\begin{document}

%%% Start of article front matter
\begin{frontmatter}

\begin{fmbox}
\dochead{Research}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the title of your article here     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Physcraper: A Python package for continually updated phylogenetic trees using the Open Tree of Life}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors here                   %%
%%                                          %%
%% Specify information, if available,       %%
%% in the form:                             %%
%%   <key>={<id1>,<id2>}                    %%
%%   <key>=                                 %%
%% Comment or delete the keys which are     %%
%% not used. Repeat \author command as much %%
%% as required.                             %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DIFdelbegin %DIFDELCMD < \author[
%DIFDELCMD <   addressref={aff1},                   % id's of addresses, e.g. {aff1,aff2}
%DIFDELCMD <   corref={aff1},                       % id of corresponding address, if any
%DIFDELCMD < % noteref={n1},                        % id's of article notes, if any
%DIFDELCMD <   email={sanchez.reyes.luna@gmail.com}   % email address
%DIFDELCMD < ]{%%%
\DIFdelend \DIFaddbegin \author[
  addressref={aff1},                   % id's of addresses, e.g. {aff1,aff2}
  % corref={aff1},                       % id of corresponding address, if any
  email={sanchez.reyes.luna@gmail.com}   % email address
]{\DIFaddend \inits{L.L.}\fnm{Luna L.} \snm{Sanchez Reyes}}
\author[
  addressref={aff1,aff2},
  email={kandziom@natur.cuni.cz}
]{\inits{M.}\fnm{Martha} \snm{Kandziora}}
\author[
  addressref={aff1},
  corref={aff1},
  email={ejmctavish@ucmerced.edu}
]{\inits{E.J.}\fnm{Emily Jane} \snm{McTavish}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors' addresses here        %%
%%                                          %%
%% Repeat \address commands as much as      %%
%% required.                                %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\address[id=aff1]{%                           % unique id
  \orgdiv{School of Natural Sciences},             % department, if any
  \orgname{University of California},          % university, etc
  \city{Merced},                              % city
  \cny{USA}                                    % country
}
\DIFdelbegin %DIFDELCMD < \address[id=aff2]{%
%DIFDELCMD <   \orgdiv{Department of Botany, Faculty of Science},
%DIFDELCMD <   \orgname{Charles University},
%DIFDELCMD <   %\street{},
%DIFDELCMD <   %\postcode{}
%DIFDELCMD <   \city{Prague },
%DIFDELCMD <   \cny{Czech Republic}
%DIFDELCMD < }
%DIFDELCMD < %%%
\DIFdelend \DIFaddbegin \address[id=aff2]{%
  \orgdiv{Department of Botany, Faculty of Science},
  \orgname{Charles University},
  %\street{},
  %\postcode{}
  \city{Prague},
  \cny{Czech Republic}
}
\DIFaddend 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter short notes here                   %%
%%                                          %%
%% Short notes will be after addresses      %%
%% on first page.                           %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\begin{artnotes}
%%\note{Sample of title note}     % note to the article
%\note[id=n1]{Equal contributor} % note, connected to author
%\end{artnotes}

\end{fmbox}% comment this for two column layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                           %%
%% The Abstract begins here                  %%
%%                                           %%
%% Please refer to the Instructions for      %%
%% authors on https://www.biomedcentral.com/ %%
%% and include the section headings          %%
%% accordingly for your article type.        %%
%%                                           %%
%% I followed sections from here:            %%
%% https://bmcbioinformatics.biomedcentral.com/submission-guidelines/preparing-your-manuscript/software-article
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstractbox}

\begin{abstract}
\parttitle{Background}
Phylogenies are a key part of research in many areas of biology. Tools that automate
some parts of the process of phylogenetic reconstruction, mainly molecular character matrix assembly,
have been developed for the advantage of both specialists in the field of phylogenetics and non-specialists.
However, interpretation of results, comparison with previously available phylogenetic
hypotheses, and selection of one phylogeny for downstream analyses and discussion still impose difficulties
to one that is not a specialist either on phylogenetic methods or on a particular group of study.

\parttitle{Results}
Physcraper is a command-line Python program that automates the update of published
phylogenies by adding public DNA sequences to underlying alignments of previously
published phylogenies. It also provides a framework for straightforward comparison
of published phylogenies with their updated versions, by leveraging upon tools from
the Open Tree of Life project to link taxonomic information across databases.
The program can be used by the nonspecialist, as a tool to generate phylogenetic
hypotheses based on publicly available expert phylogenetic knowledge.
Phylogeneticists and taxonomic group specialists will find it useful as a tool
to facilitate molecular dataset gathering and comparison
of alternative phylogenetic hypotheses (topologies).

\parttitle{Conclusions}
The Physcraper workflow showcases the benefits of doing open science for
phylogenetics, encouraging researchers to strive for better sharing practices.
Physcraper can be used with any OS and is released under an open-source license.
Detailed instructions for installation and
usage are available at \href{https://physcraper.readthedocs.io}{https://physcraper.readthedocs.io}.


\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The keywords begin here                  %%
%%                                          %%
%% Put each keyword in separate \kwd{}.     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{keyword}
\kwd{gene tree}
\DIFaddbegin \kwd{gene phylogeny}
\kwd{multilocus}
\DIFaddend \kwd{interoperability}
\kwd{open science}
\kwd{reproducibility}
\kwd{public database}
\kwd{DNA alignment}
\DIFaddbegin \kwd{Open Tree of Life}
\kwd{otol}
\DIFaddend \end{keyword}

% MSC classifications codes, if any
%\begin{keyword}[class=AMS]
%\kwd[Primary ]{}
%\kwd{}
%\kwd[; secondary ]{}
%\end{keyword}

\end{abstractbox}
%
%\end{fmbox}% uncomment this for two column layout

\end{frontmatter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                            %%
%% The Main Body begins here                  %%
%%                                            %%
%% Please refer to the instructions for       %%
%% authors on:                                %%
%% https://www.biomedcentral.com/getpublished %%
%% and include the section headings           %%
%% accordingly for your article type.         %%
%%                                            %%
%% See the Results and Discussion section     %%
%% for details on how to create sub-sections  %%
%%                                            %%
%% use \cite{...} to cite references          %%
%%  \cite{koon} and                           %%
%%  \cite{oreg,khar,zvai,xjon,schn,pond}      %%
%%                                            %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% start of article main body
% <put your article body there>

%%%%%%%%%%%%%%%%
%% Background %%
%%
\section*{Background}
Phylogenies capture the shared history of organisms and provide key evolutionary
context for our biological observations \cite{dobzhansky1973nothing}.
Updating existing phylogenies with publicly available molecular sequence data \DIFdelbegin \DIFdel{that
has never been
incorporated into any phylogenetic estimate }\DIFdelend provides
the opportunity to \DIFaddbegin \DIFadd{simultaneously }\DIFaddend study
the evolutionary history of many taxa in a reproducible and continuous manner.
Here, we introduce Physcraper, a tool that establishes a data interoperability
framework for biological databases to automate data connections across \DIFdelbegin \DIFdel{databases,
with the main goal of building on }\DIFdelend \DIFaddbegin \DIFadd{biological databases.
Physcraper's main goal is to use its interoperability framework to build upon }\DIFaddend published
alignments and \DIFdelbegin \DIFdel{extending }\DIFdelend \DIFaddbegin \DIFadd{phylogenies
to extend }\DIFaddend existing phylogenetic inferences with \DIFdelbegin \DIFdel{more data and taxa. Physcraper updates a starting tree and single locus alignments
with public DNA data,
and links the tips in these }\DIFdelend \DIFaddbegin \DIFadd{sequence data available in public
DNA databases for more taxa. Increased taxonomic sampling improves
phylogenetic reconstructions \mbox{%DIFAUXCMD
\cite{hillis1996inferring, natsidis2019phylogenomics}}\hspace{0pt}%DIFAUXCMD
,
time of divergence estimates \mbox{%DIFAUXCMD
\cite{schulte2013undersampling, soares2015influence}}\hspace{0pt}%DIFAUXCMD
,
and biogeographic analyses \mbox{%DIFAUXCMD
\cite{kayaalp2017back}}\hspace{0pt}%DIFAUXCMD
,
and help in resolving phylogenetic conflict \mbox{%DIFAUXCMD
\cite{hedtke2006resolution, townsend2010optimal, natsidis2019phylogenomics}}\hspace{0pt}%DIFAUXCMD
.
%DIF >  Physcraper updates the starting single locus alignment and corresponding phylogeny
%DIF >  with public DNA data from GenBank \cite{benson2000genbank}, and links tip taxon
%DIF >  labels in the updated trees to a unified, interoperable
%DIF >  taxonomic resource \cite{rees2017automated}, streamlining connections between phylogenies and biological data.
Physcraper links tip taxon labels in the updated }\DIFaddend trees to a unified, interoperable
taxonomic resource \cite{rees2017automated}\DIFaddbegin \DIFadd{, effectively streamlining connections between phylogenies and biological data}\DIFaddend .

Data such as
geographical location, fossil ranges, and genetic and phenotypic information increasingly
available in public \DIFaddbegin \DIFadd{biological }\DIFaddend databases constitute an amazing
resource for \DIFdelbegin \DIFdel{biological }\DIFdelend \DIFaddbegin \DIFadd{scientific }\DIFaddend discovery \cite{baxevanis2015importance}.
One of the main challenges for automatic
integration of \DIFdelbegin \DIFdel{biological data across }\DIFdelend \DIFaddbegin \DIFadd{data across biological }\DIFaddend databases are varying taxonomic idiosyncrasies.
To address this challenge, the Open Tree of Life project (OpenTree)
created a unified taxonomy for \DIFaddbegin \DIFadd{automatic taxonomic }\DIFaddend name standardization, by integrating taxonomic
data from several resources \cite{rees2017automated}, including the USA National
Center for Biodiversity Information (NCBI) taxonomy \cite{federhen_ncbi_2012, schoch_ncbi_2020},
and the Global Biodiversity Information Facility (GBIF) \cite{gbif_secretariat_gbif_2019}\DIFdelbegin \DIFdel{among others.
By using the existing OpenTree taxonomy programmatic tools to map tip names ,
Physcraper has }\DIFdelend \DIFaddbegin \DIFadd{, among many others.
OpenTree's unfified taxonomy, along with tools and methods to manage it, are available
as Application Programming Interfaces (APIs),
which are implemented as open access services for the general public \mbox{%DIFAUXCMD
\cite{opentreeAPIs}}\hspace{0pt}%DIFAUXCMD
.
Physcraper leverages on existing OpenTree's unified taxonomy APIs to automatically
standardize taxon names in any phylogeny, providing
}\DIFaddend a framework for \DIFdelbegin \DIFdel{connecting }\DIFdelend \DIFaddbegin \DIFadd{connection of }\DIFaddend updated phylogenies with data from any biological database.

Decades of single locus sequencing have generated
massive amounts of homologous DNA datasets that have the potential to be used for phylogenetic
reconstruction at many scales \cite{sanderson2008phylota}.
More than a decade ago, GenBank release 159 (April 15, 2007) already hosted 72
million DNA sequences that were gauged to have the potential to resolve phylogenetic
relationships of 98.05\% of the almost 241,000
distinct taxa in the NCBI taxonomy at the time \cite{sanderson2008phylota}.
However, even thirteen years later, phylogenetic estimates for \DIFdelbegin \DIFdel{many }\DIFdelend \DIFaddbegin \DIFadd{most }\DIFaddend of these taxa
are \DIFaddbegin \DIFadd{still }\DIFaddend not available \cite{mctavish_how_2017}.
OpenTree \DIFdelbegin \DIFdel{'s comprehensive }\DIFdelend \DIFaddbegin \DIFadd{assembles a comprehensive synthetic }\DIFaddend tree of life \DIFdelbegin \DIFdel{comprises }\DIFdelend \DIFaddbegin \DIFadd{comprising
}\DIFaddend 2.3 million tips, of which around
90,000 are supported by \DIFdelbegin \DIFdel{phylogenies }\DIFdelend \DIFaddbegin \DIFadd{publicly available expert phylogenetic data, uploaded to OpenTrees' database (the Phylesystem
\mbox{%DIFAUXCMD
\cite{mctavish2015phylesystem}}\hspace{0pt}%DIFAUXCMD
) by volunteer curators }\DIFaddend - the remaining 1.4 million taxa are placed
in the \DIFaddbegin \DIFadd{synthetic }\DIFaddend tree based on \DIFaddbegin \DIFadd{OpenTree's unified }\DIFaddend taxonomy.
There is a considerable amount of phylogenetically
informative data in GenBank with the potential to fill these phylogenetic gaps in
the tree of life, but this data either has not been analysed or the analyses
have not been made publicly available \DIFaddbegin \DIFadd{and accesible }\DIFaddend \cite{mctavish_how_2017}.

Assembling a DNA alignment from \DIFdelbegin \DIFdel{such }\DIFdelend a massive database \DIFaddbegin \DIFadd{such }\DIFaddend as GenBank can be done ``by hand",
but that is a time-consuming approach which is \DIFdelbegin \DIFdel{not highly reproducible.
A variety of }\DIFdelend \DIFaddbegin \DIFadd{largely non reproducible.
Various }\DIFaddend computational pipelines that mine DNA databases fast, efficiently, and reproducibly
have been developed and used to infer phylogenetic relationships \DIFdelbegin \DIFdel{in a variety of }\DIFdelend \DIFaddbegin \DIFadd{of many }\DIFaddend organisms
(e.g., \cite{smith2009mega, antonelli2017toward, izquierdo2014pumper, pearse2013phylogenerator}).
While genomics has, and will continue to \DIFdelbegin \DIFdel{, }\DIFdelend revolutionize phylogenetic inference,
the diversity of alternative genomic sequencing approaches \DIFdelbegin \DIFdel{implemented produce
largely }\DIFdelend \DIFaddbegin \DIFadd{that are implemented produce
widely }\DIFaddend non-overlapping homology hypotheses across taxa,
creating challenges for phylogenetic reconstruction \cite{jones2016targeted}.
Phylogenomics addresses this problem by focusing on targeted capture of informative
regions \cite{andermann2020guide}.
However, carefully curated markers and alignments can significantly improve phylogenetic
reconstructions, even in phylogenomic analyses \cite{fragoso2017pilot}.

Physcraper improves on previous work \DIFdelbegin \DIFdel{in automating phylogenetic reconstructionby leveraging
the power of }\DIFdelend \DIFaddbegin \DIFadd{that automates phylogenetic reconstruction, by leveraging
on the knowledge contained in }\DIFaddend existing homology hypotheses that \DIFaddbegin \DIFadd{phylogeneticists and }\DIFaddend taxon specialists have assessed
and deemed appropriate for a specific phylogenetic scope.
There are almost 8,200 publicly available, peer-reviewed curated alignments, covering
around 100,000 distinct taxa in the TreeBASE database
\DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{piel2009treebase}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{piel2009treebase, vos2012nexml, piel2018treebasedmp}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend ,
which can be \DIFdelbegin \DIFdel{leveraged }\DIFdelend \DIFaddbegin \DIFadd{used }\DIFaddend as seeds to mine molecular databases, and as ``jump-start'' alignments
for phylogenetic reconstruction \cite{morrison2006multiple} to continually enrich,
update and compare \DIFdelbegin \DIFdel{existing phylogenetic }\DIFdelend \DIFaddbegin \DIFadd{phylogenetic hypotheses to existing evolutionary }\DIFaddend knowledge.

Physcraper is implemented as a Python pipeline that uses OpenTree's \DIFdelbegin \DIFdel{programmatic access
protocols (API's) }\DIFdelend \DIFaddbegin \DIFadd{APIs }\DIFaddend to automatically
link any phylogeny mapped to OpenTree's \DIFdelbegin \DIFdel{standardized taxonomy\mbox{%DIFAUXCMD
\cite{mctavish2015phylesystem}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{unified taxonomy}\DIFaddend ,
to alignments from TreeBASE, and data from GenBank.
\DIFdelbegin \DIFdel{Its utility }\DIFdelend \DIFaddbegin \DIFadd{Physcraper's usage }\DIFaddend and functionalities are presented with a case-study analysis of a
group of flowering plants, the hollies.


\section*{Implementation}

\DIFaddbegin \DIFadd{Physcraper is implemented with Python and can be run on a Python interactive session,
as a Python script, or using the command line interface we developed for it.
It currently consists of 13 modules.
%DIF > % , classes, methods and functions.%%
For testing and improving Physcraper's Python code syntax quality, we
used the Pylint software following instructions from its website \mbox{%DIFAUXCMD
\cite{pylintWeb}
 }\hspace{0pt}%DIFAUXCMD
and manual \mbox{%DIFAUXCMD
\cite{pylintManual}}\hspace{0pt}%DIFAUXCMD
, with a ``.pylintrc" configuration file.
%DIF >  Based on Physcraper's software design choices, some of Pylint's recommendations were overruled
%DIF >  by using its check-disabling system, and are explained along the code.
As of now, all Physcraper modules have a Pylint score of 10/10.
}

%DIF >  Pylint score for each module and locally disabled Pylint reccommendations
%DIF >  physcraper/aligntreetax.py		10/10	pylint disabling “too many branches” and “too many locals”
%DIF >  physcraper/configobj.py 		10/10  pylint global disabling attributes defined outside init
%DIF >  physcraper/helpers.py		10/10
%DIF >  physcraper/ids.py			10/10 	pylint disabled unused-variables that are used later by other functions
%DIF >  physcraper/ncbi_data_parser.py	10/10
%DIF >  physcraper/opentree_helpers.py 10/10		we pylint-disabled “too many local variables”, “too many branches” and “too many statements”
%DIF >  physcraper/scrape.py		10/10	commented out a bare except and pylint-disabled ”globals”, “too many public methods”, “too many local variables”, “too many lines in module”, “too many branches”, “too many statements” and “no self use”
%DIF >  physcraper/treetaxon.py		10/10
%DIF >  bin/find_trees.py			10/10
%DIF >  bin/physcraper.py			10/10
%DIF >  bin/tree_comparison.py		10/10
%DIF >  bin/multi_loci.py			10/10 		Global disabled “redefined-outer-name”, “protected-access”, “too-many-branches”, “too-many-statements”, “too-many-locals”

\DIFaddend The general Physcraper framework (Figure 1) consists of 4 steps: 1) identifying and
processing a \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeny }\DIFaddend and its underlying alignment; 2) performing a BLAST search of
DNA sequences from original alignment on GenBank, and filtering of new sequences;
3) profile-aligning new sequences to original alignment; 4) performing a phylogenetic
analysis and comparing the updated \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{results }\DIFaddend to existing phylogenies.


\subsection*{The inputs: a \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeny }\DIFaddend and an alignment}

Taxon names in the input \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeny }\DIFaddend must be standardized to OpenTree\DIFdelbegin \DIFdel{taxonomy
\mbox{%DIFAUXCMD
\cite{rees2017automated} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{'s unfified taxonomy
\mbox{%DIFAUXCMD
\cite{ott3.2} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend using OpenTree's bulk Taxonomic Name Resolution Service
(TNRS) tool \cite{TNRStool}. Users can upload their
own \DIFdelbegin \DIFdel{tree}\DIFdelend \DIFaddbegin \DIFadd{phylogeny}\DIFaddend , or choose from among the 2, 950 \DIFdelbegin \DIFdel{standardized trees }\DIFdelend \DIFaddbegin \DIFadd{curated phylogenies }\DIFaddend stored in OpenTree's
Phylesystem \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{phylesystemGithub, mctavish2015phylesystem} }\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{database \mbox{%DIFAUXCMD
\cite{phylesystemGithub} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend that also have
alignments available on \DIFdelbegin \DIFdel{TreeBASE \mbox{%DIFAUXCMD
\cite{piel2009treebase}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{the TreeBASE database \mbox{%DIFAUXCMD
\cite{treebase_website, supertreebase}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend .

The input alignment is a single locus DNA dataset that was used in part or in
whole to generate the input \DIFdelbegin \DIFdel{tree}\DIFdelend \DIFaddbegin \DIFadd{phylogeny}\DIFaddend . Physcraper retrieves TreeBASE alignments
automatically. Alternatively, users \DIFdelbegin \DIFdel{must }\DIFdelend \DIFaddbegin \DIFadd{can }\DIFaddend provide the path to a local copy of the
alignment \DIFaddbegin \DIFadd{of their choosing}\DIFaddend .
Only taxa that are both in the sequence alignment and in the \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeny }\DIFaddend are considered
further for analysis; at least one taxon and its corresponding sequence are required.

\subsection*{DNA sequence search and filtering}

The Basic Local Alignment Search Tool, BLAST \cite{altschul1990basic} is used for DNA
sequence search \DIFaddbegin \DIFadd{either }\DIFaddend on a remote or \DIFaddbegin \DIFadd{a }\DIFaddend local GenBank database. It is constrained to a
 ``search taxon", \DIFdelbegin \DIFdel{a taxonomic group in the NCBI taxonomy that is automatically
identified using the OpenTree's taxonomic }\DIFdelend \DIFaddbegin \DIFadd{which corresponds to the }\DIFaddend Most Recent Common Ancestor (MRCA) \DIFdelbegin \DIFdel{API
\mbox{%DIFAUXCMD
\cite{mrcaAPI, rees2017automated}}\hspace{0pt}%DIFAUXCMD
, as the MRCA }\DIFdelend of
all ingroup taxa that is also a named clade in the NCBI taxonomy (Figure 1). \DIFaddbegin \DIFadd{The
search taxon is identified using OpenTree's unified taxonomic API \mbox{%DIFAUXCMD
\cite{mrcaAPI}}\hspace{0pt}%DIFAUXCMD
.
}\DIFaddend 

BLAST is performed using the blastn algorithm \cite{camacho2009blast}
implemented in BioPython \DIFdelbegin \DIFdel{'s }\DIFdelend \DIFaddbegin \DIFadd{1.71 }\DIFaddend \cite{cock2009biopython} NCBIWWW module \cite{ncbiwww}
modified to accept an alternative BLAST address.
Each sequence in the alignment is BLASTed once against \DIFdelbegin \DIFdel{all DNA sequences in GenBank .
New sequences are excluded for }\DIFdelend \DIFaddbegin \DIFadd{the GenBank database.
Matching sequences are filtered and excluded from the }\DIFaddend analysis if they 1) are not in the search taxon;
2) have an e-value above the cutoff (default to 0.00001); 3) fall outside a \DIFdelbegin \DIFdel{min
and max }\DIFdelend \DIFaddbegin \DIFadd{minimum
and maximum sequence }\DIFaddend length threshold, defined as \DIFdelbegin \DIFdel{the }\DIFdelend \DIFaddbegin \DIFadd{a }\DIFaddend proportion of the average \DIFaddbegin \DIFadd{sequence }\DIFaddend length without
gaps of all sequences in \DIFaddbegin \DIFadd{the }\DIFaddend input alignment (default values of 80%DIF <  and 120%,
\DIFaddbegin \DIFadd{\% and 120\%,
}\DIFaddend respectively); 4) or\DIFaddbegin \DIFadd{, }\DIFaddend if they are either identical to or shorter than an existing
sequence in the input alignment and they represent the same taxon in \DIFdelbegin \DIFdel{OpenTree or
NCBItaxonomy.
An }\DIFdelend \DIFaddbegin \DIFadd{NCBI's or
OpenTree's unififed taxonomy.
By default, an }\DIFaddend arbitrary maximum number of \DIFdelbegin \DIFdel{randomly chosen }\DIFdelend \DIFaddbegin \DIFadd{5 }\DIFaddend sequences per taxon are \DIFdelbegin \DIFdel{allowed
(default to 5)}\DIFdelend \DIFaddbegin \DIFadd{chosen at random
from the set of matching sequences that passed the filtering step}\DIFaddend .

Reverse, complement, and reverse-complement sequences are identified and translated
using BioPython internal functions \cite{cock2009biopython}.
Iterative cycles of BLAST searches can be performed, by blasting all new sequences
until no new ones are found. By default only one BLAST cycle is performed.

\subsection*{New DNA sequence alignment}

MUSCLE \cite{edgar2004muscle} is used to perform a profile alignment in which the
original alignment is used as a template of homology criteria to align new sequences.
The final alignment is not further automatically checked, and additional inspection
and refinement are recommended.

\subsection*{\DIFdelbegin \DIFdel{Tree }\DIFdelend \DIFaddbegin \DIFadd{Phylogenetic }\DIFaddend reconstruction and comparison}

RAxML \cite{stamatakis2014raxml} is implemented to reconstruct a Maximum Likelihood
(ML) gene \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeny }\DIFaddend for each input alignment with default settings (GTRCAT model and
100 bootstrap replicates with default algorithm), using \DIFdelbegin \DIFdel{input tree }\DIFdelend \DIFaddbegin \DIFadd{the input phylogeny }\DIFaddend as starting
tree for ML searches.
Bootstrap results are summarized using DendroPy's SumTrees module
\cite{sukumaran2010dendropy}.

Physcraper's main result is an updated phylogenetic hypothesis for the search taxon.
Updated and original \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogeies }\DIFaddend are compared with Robinson-Foulds weighted and unweighted
metrics \DIFdelbegin \DIFdel{estimated }\DIFdelend \DIFaddbegin \DIFadd{calculated }\DIFaddend with Dendropy \cite{sukumaran2010dendropy}, and with a node by node
comparison between the synthetic OpenTree and \DIFaddbegin \DIFadd{the }\DIFaddend original and updated \DIFdelbegin \DIFdel{tree }\DIFdelend \DIFaddbegin \DIFadd{phylogenies }\DIFaddend individually,
using OpenTree's conflict API \cite{redelings2017supertree}.


\section*{Results}
\subsection*{Case Study: The hollies}

A user is interested in phylogenetic relationships within the genus \textit{Ilex}. Commonly
known as ``hollies", the genus encompasses between \DIFdelbegin \DIFdel{400-700 living species }\DIFdelend \DIFaddbegin \DIFadd{400 \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}
}\hspace{0pt}%DIFAUXCMD
and 500 recognized living species \mbox{%DIFAUXCMD
\cite{plantlist}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , and is
the only extant \DIFdelbegin \DIFdel{clade }\DIFdelend \DIFaddbegin \DIFadd{taxon }\DIFaddend within the family Aquifoliaceae, \DIFaddbegin \DIFadd{in the }\DIFaddend order Aquifoliales of flowering
plants \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{chase2016update}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend .

An online literature review in June 2020 (Google scholar search for ``ilex phylogeny")
\DIFdelbegin \DIFdel{reveals }\DIFdelend \DIFaddbegin \DIFadd{revealed }\DIFaddend that there are several published \DIFdelbegin \DIFdel{phylogenies showing }\DIFdelend \DIFaddbegin \DIFadd{studies addressing phylogenetic }\DIFaddend relationships within
the hollies \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{cuenoud2000molecular, manen2010history, setoguchi2000intersectional,
selbach2009new}}\hspace{0pt}%DIFAUXCMD
}\DIFdelend \DIFaddbegin \DIFadd{\mbox{%DIFAUXCMD
\cite{cuenoud2000molecular, gottlieb2005molecular, manen2010history,
setoguchi2000intersectional, selbach2009new, yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
}\DIFaddend , but only \DIFdelbegin \DIFdel{two }\DIFdelend \DIFaddbegin \DIFadd{the ``Gottlieb2005"
study \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular} }\hspace{0pt}%DIFAUXCMD
and the ``Yao2020" study \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}
}\hspace{0pt}%DIFAUXCMD
}\DIFaddend have data openly available\DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{gottlieb2005molecular, yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
.
\mbox{%DIFAUXCMD
\cite{gottlieb2005molecular} }\hspace{0pt}%DIFAUXCMD
made original tree and alignment }\DIFdelend \DIFaddbegin \DIFadd{.
The Gottlieb2005 phylogeny and alignment are }\DIFaddend available in TreeBASE \DIFdelbegin \DIFdel{(}\DIFdelend study 1091 \cite{treebase1091}\DIFdelbegin \DIFdel{).
The tree sampling }\DIFdelend \DIFaddbegin \DIFadd{.
The Gottlieb2005 phylogeny samples }\DIFaddend 41 species\DIFdelbegin \DIFdel{is also available from
}\DIFdelend \DIFaddbegin \DIFadd{, is available in
}\DIFaddend OpenTree's Phylesystem (study pg\_2827 \cite{pg2827}),
and has been integrated into OpenTree's synthetic tree \cite{mrcaott68451ott89474}.
The \DIFdelbegin \DIFdel{most recent }\DIFdelend \DIFaddbegin \DIFadd{Yao2020 }\DIFaddend \textit{Ilex} \DIFdelbegin \DIFdel{tree \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
is }\DIFdelend \DIFaddbegin \DIFadd{phylogeny is the most recent one for the genus \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
,
and it is only }\DIFaddend available in OpenTree's Phylesystem (study ot\_1984 \cite{ot1984}),
and in the DRYAD repository \cite{yao2020dryad}.
With 175 tips, the \DIFdelbegin \DIFdel{\mbox{%DIFAUXCMD
\cite{yao2020phylogeny} }\hspace{0pt}%DIFAUXCMD
tree }\DIFdelend \DIFaddbegin \DIFadd{Yao2020 phylogeny \mbox{%DIFAUXCMD
\cite{yao2020phylogeny} }\hspace{0pt}%DIFAUXCMD
}\DIFaddend is the best sampled phylogeny \DIFdelbegin \DIFdel{yet }\DIFdelend available for
the \DIFdelbegin \DIFdel{hollies.
}%DIFDELCMD < 

%DIFDELCMD < %%%
\DIFdel{We ran Physcraperon a laptop Linux computer to update an }\DIFdelend \DIFaddbegin \DIFadd{genus }\textit{\DIFadd{Ilex}}\DIFadd{.
In order to showcase Physcraper's performance, we chose the Gottlieb2005 phylogeny
and a corresponding single locus alignment of the }\DIFaddend internal transcribed
spacer DNA region (ITS) \DIFdelbegin \DIFdel{alignment from \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}}\hspace{0pt}%DIFAUXCMD
,
using a local
GenBank database}\DIFdelend \DIFaddbegin \DIFadd{as Physcraper inputs, to update relationships in the genus }\textit{\DIFadd{Ilex}}\DIFadd{.
Currently being the best sampled and most recent phylogenetic hypothesis for }\textit{\DIFadd{Ilex}}\DIFadd{,
we used the Yao2020 phylogeny as the ideal standard to compare results from this
Physcraper case study.
}

\DIFadd{We ran Physcraper on a computer node of the Multi-Environment Research Computer for
Exploration and Discovery (MERCED) Linux cluster from the University of California,
Merced, using one core at 2301 MHz RAM}\DIFaddend . BLAST and RAxML analyses ran for 19hrs 45min, with bootstrap
analyses taking an additional 13hrs.
%% <!-- MTH: you probably need some details about the hardware, given the fact that you are discussing running times -->
The \DIFdelbegin \DIFdel{updated \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular} }\hspace{0pt}%DIFAUXCMD
tree }\DIFdelend \DIFaddbegin \DIFadd{Gottlieb2005 phylogeny \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular} }\hspace{0pt}%DIFAUXCMD
updated using Physcraper }\DIFaddend (Figure 2\DIFaddbegin \DIFadd{;
Physcraper updated phylogeny from now on}\DIFaddend ) displays all 41 distinct
taxa from the original study plus 231 new tips, contributing phylogenetic data to
84 additional \textit{Ilex} taxa. The best \DIFdelbegin \DIFdel{RaxML tree }\DIFdelend \DIFaddbegin \DIFadd{ML phylogeny from the RAxML analysis }\DIFaddend is 99\%
resolved, with 25\% of nodes with bootstrap support $<$ 0.1 and 48\% nodes with
bootstrap support $>$ 0.75 \DIFaddbegin \DIFadd{(Figure 2A)}\DIFaddend .
A large portion of internal branches are negligibly small, with 30 branches
$<$ 0.00001 substitution rate units, from which only 9 have a bootstrap support $>$ 0.75
(Figure 2).
\DIFdelbegin \DIFdel{For comparison , }\DIFdelend \DIFaddbegin \DIFadd{As comparison with the Physcraper updated phylogeny, the Yao2020 phylogeny }\DIFaddend \cite{yao2020phylogeny}
also contains all 41 distinct taxa
\DIFdelbegin \DIFdel{from
the original
\mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}}\hspace{0pt}%DIFAUXCMD
study,
and contributes }\DIFdelend \DIFaddbegin \DIFadd{sampled in the Gottlieb2005 phylogeny \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}}\hspace{0pt}%DIFAUXCMD
,
while contributing }\DIFaddend phylogenetic data to 134 additional \textit{Ilex} taxa\DIFdelbegin \DIFdel{, from which
}\DIFdelend \DIFaddbegin \DIFadd{. From these,
}\DIFaddend 67 \DIFaddbegin \DIFadd{taxa }\DIFaddend are also in \DIFdelbegin \DIFdel{updated \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}}\hspace{0pt}%DIFAUXCMD
.
While \mbox{%DIFAUXCMD
\cite{yao2020phylogeny} }\hspace{0pt}%DIFAUXCMD
also used
}\DIFdelend \DIFaddbegin \DIFadd{the Physcraper updated phylogeny.
While the Yao2020 phylogeny \mbox{%DIFAUXCMD
\cite{yao2020phylogeny} }\hspace{0pt}%DIFAUXCMD
was also constructed using
}\DIFaddend ITS as a marker, their GenBank data is not released yet\DIFdelbegin \DIFdel{, so }\DIFdelend \DIFaddbegin \DIFadd{. Hence, }\DIFaddend Physcraper was unable
to incorporate 68 \DIFdelbegin \DIFdel{additional taxa into the analysis.
However, }\DIFdelend \DIFaddbegin \DIFadd{taxa that are only on the Yao2020 phylogeny because the DNA data is unavailable.
We also note that Physcraper incorporates 18 }\textit{\DIFadd{Ilex}} \DIFadd{taxa that are not in the Yao2020
phylogeny \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
. These taxa appear nested among other }\textit{\DIFadd{Ilex}}
\DIFadd{species (Figure 2B) and visual inspection of the DNA sequences suggests they are
correctly assigned as }\textit{\DIFadd{Ilex}}\DIFadd{.
The ITS alignment that underlies the Yao2020 phylogeny was constructed without any tool to
mine GenBank \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
, which could explain why }\DIFaddend Physcraper was able to
incorporate \DIFaddbegin \DIFadd{these }\DIFaddend 18 \DIFdelbegin \DIFdel{taxa that were not in \mbox{%DIFAUXCMD
\cite{yao2020phylogeny}}\hspace{0pt}%DIFAUXCMD
. }\DIFdelend \DIFaddbegin \DIFadd{additional }\textit{\DIFadd{Ilex}} \DIFadd{taxa in the Physcraper updated phylogeny.
}\DIFaddend 

%DIF > % Maybe show conflict results? and then add to the discussion. YES
\DIFaddbegin 

\subsection*{\DIFadd{Verification test}}

\DIFadd{To test the performance of Physcraper we performed a verification test in which
we pruned 9 out of the 41 tips in the original Gottlieb2005 phylogeny \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}}\hspace{0pt}%DIFAUXCMD
,
corresponding to a 20\% trim, excluding the outgroups. We then performed a Physcraper
run to test if we would recover the pruned tips. To perform the BLAST searches,
Physcraper automatically drops sequences from the alignment belonging to taxa
absent from the input phylogeny.
The Physcraper updated phylogeny successfully recovered only 6 out of 9 pruned tips.
Closer examination of results revealed that sequences for the 3 missing tips were correctly retrieved
with BLAST along with the 6 sequences belonging to the remaining pruned tips.
We then followed the GenBank accession numbers reported in \mbox{%DIFAUXCMD
\cite{gottlieb2005molecular}
}\hspace{0pt}%DIFAUXCMD
belonging to the sequences of the 3 missing tips, }\textit{\DIFadd{Ilex warburgii}} \DIFadd{(accession
number reported: U92600/U92601; updated: AH007153.2), }\textit{\DIFadd{Ilex dimorphophylla}}
\DIFadd{(accession number reported: U92592/U92593; updated: AH007149.2),
and }\textit{\DIFadd{Ilex percoriacea}} \DIFadd{(accession number: AH007156.2). We note that these three sequences
contain a 100 bp long gap of unidentified nucleotides (Ns) that is completely absent
from the original alignment. This caused them to exceed Physcraper's default sequence
length cutoff of 120\%, being thus filtered and excluded from further analyses.
The missing ITS sequences do appear in Physcraper's output file ``seqlen\_mismatch.txt",
that includes the accession number, taxon name, and sequence length of all BLAST matches
that were filtered based on sequence length cutoffs set in the configuration file.
}


\DIFaddend \section*{Discussion}
Databases preserving and democratizing access to biological data
have become essential resources for science.
New molecular data keep accumulating and tools facilitating its integration into
existent evolutionary knowledge contribute to the acceleration of scientific discovery.

\DIFaddbegin \DIFadd{Physcraper is a tool that builds upon previous knowledge stored in published
alignments and phylogenies, taking advantage of OpenTree's services to facilitate comparison
of phylogenies, with the main goal of extending our knowledge of phylogenetic relationships
across the tree of life.
}

\DIFaddend We believe this is a key step to successfully establish an open, reproducible workflow for phylogenetics,
facilitating phylogenetic knowledge for ecologists and other non-specialists, effectively
democratizing phylogenetic studies.

As a tool for automatizing phylogenetic reconstruction from molecular databases,
Physcraper presents several advantages over existing phylogenetic pipelines designed to
make evolutionary sense of the vast amount of
public molecular data available.

Several analysis tools create full phylogenies \textit{de novo} by mining of molecular
databases \cite{antonelli2017toward, sanderson2008phylota, smith2019pyphlawd,
bennett2018phylotar, pearse2013phylogenerator}.
In particular, Phylota \cite{sanderson2008phylota},
and PHLAWD \cite{smith2009mega}, have been cited and used abundantly.

Physcraper builds on this automated database mining concept by incorporating prior
phylogenetic work and existing taxonomic domain knowledge on appropriate markers
and alignment construction.
This decreases error (requiring less manual downstream processing) and
eases comparison with previous phylogenetic knowledge.
\DIFaddbegin 

\DIFadd{Results from the verification test highlight the importance of incorporating existing expertly
curated homology statements to automatically update phylogenetic relationships, instead
of ignoring the information they contain and building homology statements fully }\textit{\DIFadd{de novo}}\DIFadd{.
}

\DIFadd{We encourage users to look at the output files containing information about the
filtered sequences, and potentially modify configuration parameters such as the
sequence length cutoff parameter, based on the filtered sequences.
Default filtering parameters are arbitrary, but we hope that by making the process
of locating homologous sequences online reproducible, and tracking what filters
are used, we make it easier for researchers to delve into the effect that different
choices have on their inferences.
This is in contrast to ``manual" searches for taxa, where similarly arbitrary filters
are applied, but are difficult to trace.
As many studies have shown \mbox{%DIFAUXCMD
\cite{huang_what_2009} }\hspace{0pt}%DIFAUXCMD
the effect of missing data can
be enigmatic, and interact with the true phylogenetic relationships for the data
set at hand.
There is not currently strong support in the literature for any particular cutoff
value, and rather than prescribe specific approaches, we encourage users to explore
the effects of different choices on their phylogenetic inferences.
In addition, by providing the output files at each step of the analysis,
it is straightforward to assess how changing parameter and software choices do or
do not drive differences in phylogenetic inference.
By gathering the sequences, and making the unaligned files easily available to users,
researchers can compare if applying any alternate alignment tool of their choice
affects inferences.
Once sequences are aligned, they can apply and compare inferences from any phylogenetic
software.
}

\DIFadd{Organellar genome sequences, such as chloroplasts and mitochondria will also generally
be excluded from automatic addition based on default Physcraper length cutoffs.
Multiple sequence alignment of loci of drastically different lengths is unfeasible,
and we have found in testing that it often returns incorrect results, splitting
shorter sequences with many long gaps to align with exact matches across the entire
longer locus.
While it would be possible to directly extract the BLAST match from genomes, this
 would exclude potentially homologous flanking regions which are not matched
by BLAST's local search algorithm, but that may be important for phylogenetic inference.
Instead we list the accession numbers for these matches in the ``seqlen\_mismatch.txt"
file, for users to assess and incorporate appropriate homologous regions to their
alignment of interest.
}

\DIFaddend Unlike phylogenetic placement approaches \cite{berger_performance_2011, matsen_pplacer_2010},
which add new taxa without modifying the input \DIFdelbegin \DIFdel{tree}\DIFdelend \DIFaddbegin \DIFadd{phylogeny}\DIFaddend , Physcraper estimates all
the relationships anew in the context of the new data.
PUMPER \cite{izquierdo2014pumper} shares these conceptual strengths, but is no
longer under active development, is challenging to install and run, and has resulted
in very few phylogenetic analyses since its publication.

Physcraper generates gene trees, which individually do not capture the full complexity
of species' evolutionary history \cite{song2012resolving}. \DIFdelbegin \DIFdel{However, Physcraper facilitates
}\DIFdelend \DIFaddbegin \DIFadd{In addition, single gene
phylogenies with very high numbers of taxa may lack sufficient signal
for accurate phylogenetic resolution \mbox{%DIFAUXCMD
\cite{morel_phylogenetic_2020}}\hspace{0pt}%DIFAUXCMD
.
The Physcraper workflow avoids this challenge by focusing on ingroup
taxa of an existing phylogeny, using markers that have been assessed and proven
appropriate for that phylogenetic scope in past publications.
Also, Physcraper thins alignments by removing sequences identical to original
and newly added sequences, and by setting a maximum number of sequences per taxon.
Nonetheless, it is incumbent on users to assess their final inference with respect
to statistical support and biological plausibility.
%DIF >  Add citation of good things about thining alignments
}

\DIFadd{In the era of phylogenomics, rigorous analyses of multiple loci still allow for
more complex evolutionary models
than analyses of large genomic data sets, and in many cases can provide better evolutionary estimates.
For example \mbox{%DIFAUXCMD
\cite{zhu_complexity_2021} }\hspace{0pt}%DIFAUXCMD
show that when applying coalescent models,
there is more information in two genes of 300 bp each than in 600 independent sites.
Physcraper is designed to facilitate
}\DIFaddend gathering alignments and gene trees for multiple loci from a group of interest,
that together can be used to reconstruct species trees taking into account coalescent
processes with ASTRAL \cite{mirarab2014astral} \DIFdelbegin \DIFdel{,
BEAST2 \mbox{%DIFAUXCMD
\cite{bouckaert2019beast}}\hspace{0pt}%DIFAUXCMD
, }\DIFdelend or SVD Quartets \cite{chifman2014quartet}\DIFaddbegin \DIFadd{.
Physcraper's ``multi\_locus.py'' module allows to automatically
merge the outputs of Physcraper runs from different loci into input files for the
two software mentioned above, or as concatenated alignments for supermatrix analyses.
}


%DIF > % Biological plausibility of example??
\DIFadd{Our case study application of Physcraper to update a phylogeny of the genus }\textit{\DIFadd{Ilex}} \DIFadd{is based on a
single marker, so we expect for it to be not as well resolved as phylogenies resulting from analyses
that used multiple markers. Although not perfect,
we think the Physcraper updated }\textit{\DIFadd{Ilex}} \DIFadd{phylogeny seems biologically reasonable
in different ways. All samples
corresponding to the ingroup cluster together forming a monophyletic group (Figure 2A), and
samples belonging to the same }\textit{\DIFadd{Ilex}} \DIFadd{species also form
monophyletic groups (Figure 2B}\DIFaddend ). \DIFdelbegin \DIFdel{Rigorous analyses of multiple loci allows for more complex evolutionary models
than analysesof large genomic data sets, and can provide better evolutionary estimates. }\DIFdelend \DIFaddbegin \DIFadd{A notable exception is samples of the species }\textit{\DIFadd{Ilex theeizans}}\DIFadd{, which appear as
non-monophyletic in the updated phylogeny as well as in the original Gottlieb2005 phylogeny.
%DIF >  This suggests that the samples might represent two different species, but further
%DIF >  analyses should be conducted.
A visual comparison of the Yao2020 phylogeny and the original Gottlieb2005 phylogeny suggests
that the relationships within the genus }\textit{\DIFadd{Ilex}} \DIFadd{are still being actively
determined, and that increased taxon sampling might be key to resolve them.
}\DIFaddend 

Physcraper has the added advantage of facilitating the linkage of taxonomic information about tips
in the output phylogenies to data available in a variety of biological databases
\cite{rees2017automated}, such as
geographical locations for taxa from the GBIF \cite{gbif_secretariat_gbif_2019}.
\DIFaddbegin \DIFadd{Taxonomic links, and comparisons to existing published phylogenies in the OpenTree
data store can also help flag paralogous sequences.
Accidentally including paralogs as homologs is a risk in phylogenetic analyses,
and can be more prevalent in automated analyses than in manually curated analyses.
We provide users with several tools to try to assess homology of their aligned sequences.
The estimated gene phylogeny itself is an evolutionarily explicit way to visualize gene
evolution, which in concert with taxonomic labelling can reveal paralogy.
OpenTree's conflict analysis tool informs the users of whether their phylogeny contains major
conflicts with established taxonomy and any phylogenetic context they wish to compare to.
This tool also returns information on taxonomic and phylogenetic conflicts that exist
in the original input phylogeny.
Detected conflicts may be a sign that taxonomy needs to be updated, or may be a sign
that non-homologous sequences have been included in the analysis.
These taxonomic and phylogenetic conflicts flag regions of the phylogeny for the researcher
to more closely examine and assess homology.
}\DIFaddend 

The Physcraper workflow can be used to rapidly (in a matter of hours) create
phylogenies which can address challenges overarching both fields of ecology and evolution, such as
phylogenetically placing newly discovered species \cite{webb2010biodiversity},
curating taxonomic assignments
\cite{san2010molecular},
and generating custom trees for ecological \cite{helmus2012phylogenetic} and
evolutionary downstream analyses \cite{stoltzfus2013phylotastic}.

\section*{Conclusions}
Data repositories hold more information than meets the eye.
Beyond the main data, they are rich sources of metadata that can be leveraged
for the advantage of all areas of biology as well as the advancement of scientific
policy\DIFdelbegin \DIFdel{and applications }\DIFdelend \DIFaddbegin \DIFadd{, applications and education}\DIFaddend .
Initial ideas about the data are constantly changed by results from new analyses.
Physcraper provides a framework for reproducible phylogenetics that has the
potential to consistently provide context for these ideas, highlighting the
importance of data sharing and open science \DIFdelbegin \DIFdel{in the field}\DIFdelend \DIFaddbegin \DIFadd{for phylogenetics}\DIFaddend , biology and science.

\section*{Availability and requirements}

\textbf{Project name:} Physcraper

\textbf{Project home page:} \href{https://physcraper.readthedocs.io/en/latest/index.html}{https://physcraper.readthedocs.io/en/latest/index.html}

\textbf{Operating System:} Linux, Mac, Windows

\textbf{Programming Language:} Python

\textbf{Other requirements:} Dependencies

\textbf{License:} GNU

\textbf{Any restrictions to use by non-academics:} As specified by the License

\section*{Abbreviations}

\textbf{OpenTree:} The Open Tree of Life project

\textbf{TNRS:} Taxonomic Name Resolution Service

\textbf{MRCA:} Most Recent Common Ancestor

\textbf{BLAST:} Basic Local Alignment Search Tool

\textbf{NCBI:} USA National Center for Biodiversity Information

\textbf{GBIF:} Global Biodiversity Information Facility

\DIFaddbegin \textbf{\DIFadd{API:}} \DIFadd{Application Programming Interface
}

\DIFaddend %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Backmatter begins here                   %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Declarations}

\begin{backmatter}

\section*{Ethics approval and consent to participate}
Not applicable.

\section*{Consent for publication}
Not applicable.

\section*{Availability of data and materials}

\DIFdelbegin \DIFdel{The }\DIFdelend \DIFaddbegin \DIFadd{Code and }\DIFaddend datasets generated and analysed during the current study are available in
the repositories ``physcraper" containing the source code,
\href{https://github.com/McTavishLab/physcraper}{https://github.com/McTavishLab/physcraper};
 ``physcraperex" containing the examples,
\href{https://github.com/McTavishLab/physcraperex}{https://github.com/McTavishLab/physcraperex};
and, ``physcraper\_ms" containing this reproducible manuscript,
\href{https://github.com/McTavishLab/physcraper\_ms}{https://github.com/McTavishLab/physcraper\_ms}.

\section*{Competing interests}
The authors declare that they have no competing interests.

\section*{Funding}
This research was supported by the grant ``Sustaining the Open Tree of Life", NSF ABI
No. 1759838, and ABI No. 1759846.
Computer time was provided by the Multi-Environment Research Computer for
Exploration and Discovery (MERCED) cluster from the University of California,
Merced (UCM), supported by the NSF Grant No. ACI-1429783.

\section*{Authors' contributions}
LLSR wrote manuscript, alignment code, documentation, performed analyses and developed examples; MK wrote code for ncbidataparser module, filtering of sequences per OTU and using offline blast searches, wrote documentation and tests; EJM conceived study, wrote most of the code, documentation and tests.
All authors contributed to the manuscript and gave final approval for publication.


\section*{Acknowledgements}
We thank the members of the OpenTree development team and the ``short bar" Science
and Engineering Building 1, UCM, joint lab paper discussion group for valuable
comments on this manuscript. \DIFaddbegin \DIFadd{We also thank the valuable comments of David Posada, Rutger Vos,
and an anonymous reviewer that greatly improved an earlier version of this manuscript.
}\DIFaddend 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                  The Bibliography                       %%
%%                                                         %%
%%  Bmc_mathpys.bst  will be used to                       %%
%%  create a .BBL file for submission.                     %%
%%  After submission of the .TEX file,                     %%
%%  you will be prompted to submit your .BBL file.         %%
%%                                                         %%
%%                                                         %%
%%  Note that the displayed Bibliography will not          %%
%%  necessarily be rendered by Latex exactly as specified  %%
%%  in the online Instructions for Authors.                %%
%%                                                         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% if your bibliography is in bibtex format, use those commands:
\bibliographystyle{bmc-mathphys} % Style BST file (bmc-mathphys, vancouver, spbasic).
\bibliography{bmc_article}      % Bibliography file (usually '*.bib' )
% for author-year bibliography (bmc-mathphys or spbasic)
% a) write to bib file (bmc-mathphys only)
% @settings{label, options="nameyear"}
% b) uncomment next line
%\nocite{label}

% or include bibliography directly:
% \begin{thebibliography}
% \bibitem{b1}
% \end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Figures                       %%
%%                               %%
%% NB: this is for captions and  %%
%% Titles. All graphics must be  %%
%% submitted separately and NOT  %%
%% included in the Tex document  %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%
%% Do not use \listoffigures as most will included as separate files

\section*{Figures}
  \begin{figure}[h!]
  \caption{The Physcraper framework consists of four general steps. The \DIFaddbeginFL \DIFaddFL{star represents
  the ``search taxon", the Most Recent Common Ancestor (MRCA) of all taxa in the
  ingroup that is also a named clade in the NCBI taxonomy. The }\DIFaddendFL software is fully
  described on its documentation website at \href{https://physcraper.readthedocs.io}{https://physcraper.readthedocs.io},
  along with installation instructions, function usage descriptions, examples and tutorials.
}
\end{figure}

\begin{figure}[h!]
  \caption{A) Phylogeny updated with Physcraper \DIFaddbeginFL \DIFaddFL{using a starting phylogeny and an alignment }\DIFaddendFL from
  \DIFdelbeginFL \DIFdelFL{original
  }\DIFdelendFL \cite{gottlieb2005molecular} \DIFdelbeginFL \DIFdelFL{tree }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{(Gottlieb2005 data }\DIFaddendFL in \DIFdelbeginFL \DIFdelFL{B}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{text)}\DIFaddendFL .
  Tips in original alignment and new tips added with Physcraper are depicted in
  black and red, respectively. Physcraper obtained sequences from the GenBank
  database via local BLAST of all sequences \DIFdelbeginFL \DIFdelFL{in }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{from }\DIFaddendFL the \DIFaddbeginFL \DIFaddFL{Gottlieb2005 internal transcribed
  spacer DNA region (ITS) }\DIFaddendFL original alignment\DIFdelbeginFL \DIFdelFL{that generated
  tree in B)}\DIFdelendFL ,
  filtered them following criteria \DIFdelbeginFL \DIFdelFL{from }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{described in }\DIFaddendFL section ``DNA sequence search and
  filtering", aligned them to \DIFaddbeginFL \DIFaddFL{the }\DIFaddendFL original alignment using MUSCLE\DIFaddbeginFL \DIFaddFL{, }\DIFaddendFL and performed a
  phylogenetic reconstruction using RAxML\DIFaddbeginFL \DIFaddFL{, }\DIFaddendFL with 100 bootstraps. \DIFdelbeginFL \DIFdelFL{B-D }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{B) Results of }\DIFaddendFL conflict
  \DIFdelbeginFL \DIFdelFL{analyses
  }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{analysis }\DIFaddendFL performed \DIFdelbeginFL \DIFdelFL{with }\DIFdelendFL \DIFaddbeginFL \DIFaddFL{using }\DIFaddendFL OpenTree\DIFdelbeginFL \DIFdelFL{tools}\DIFdelendFL \DIFaddbeginFL \DIFaddFL{'s conflict tool \mbox{%DIFAUXCMD
\cite{redelings2017supertree}}\hspace{0pt}%DIFAUXCMD
.
  The Physcraper updated Gottlieb2005 phylogeny in (A) was compared to an }\textit{\DIFaddFL{Ilex}}
  \DIFaddFL{OpenTree synthetic subtree v. 12.3 \mbox{%DIFAUXCMD
\cite{ott727571} }\hspace{0pt}%DIFAUXCMD
constructed using taxonomy of the genus
  as backbone and resolving branches based on phylogenetic data from the original
  Gottlieb2005 phylogeny. Green branches are resolved by the updated phylogeny,
  blue branches are in agreement between the updated phylogeny and the syntehtic subtree, and
  orange branches are in conflict between the two}\DIFaddendFL .
}
\end{figure}


\end{backmatter}
\end{document}
